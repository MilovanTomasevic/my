<!DOCTYPE html>
<html>

<head>
	<title>[High-performance computing (HPC)](/courses/#table-of-contents)</title>
	<meta charset="utf-8">
	<link rel="stylesheet" href="../remarkslides.css">
	<!-- MathJax‚Ñ¢ -->
	<script type="text/javascript" async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-MML-AM_CHTML" async>
	</script>
	<!-- mermaid dijagram -->
	<link rel="stylesheet2" href="../mermaid.min.css">
	<script>
		mermaid.initialize({startOnLoad:true});
	</script>
	<!-- Global site tag (gtag.js) - Google Analytics -->
	<script async src="https://www.googletagmanager.com/gtag/js?id=UA-127734928-1"></script>
	<script>
		window.dataLayer = window.dataLayer || [];
		      function gtag(){dataLayer.push(arguments);}
		      gtag('js', new Date());
		
		      gtag('config', 'UA-127734928-1');
	</script>
	<!-- google analytics -->
	<script>
		(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
		      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
		      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
		      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
		      ga('create', 'UA-127734928-1', 'auto');
		      ga('send', 'pageview');
	</script>
</head>

<body>
	<textarea id="source">class: center, middle

## [High-performance computing (HPC)](/courses/#table-of-contents)
### V5-openMPI


.author[[dr. Milovan Toma≈°eviƒá](https://www.milovantomasevic.com/resume/)]

.small[[Fakulteta za informacijske ≈°tudije v Novem mestu (FI≈†)](https://www.fis.unm.si/en/)</br>![:scale 10%](../fis/fis.png) .small[ [üåê‚ûô milovan.tomasevic.fis.unm.si](http://milovan.tomasevic.fis.unm.si)</br> [üìß‚ûô milovan.tomasevic@fis.unm.si](mailto:milovan.tomasevic@fis.unm.si)]]



.created[08.03.2019 u 17:50]


---


name: sadrzaj

# Sadr≈æaj

- [Hibridno programiranje](#hp)
- [Primer](#primer)
- [Prednosti](#prednosti)
- [Arhitekture](#arhitekture)
- [Gradivni elementi](#gradivni)
- [Klasifikacija](#klasifikacija)
- [Zadaci](#zadaci)

---
name: hp
class: center, middle, inverse

# Hibridno programiranje

---
layout: true

.section[[Hibridno programiranje](#sadrzaj)]

---
## Hibridno programiranje

- Podrazumeva kombinovano kori≈°ƒáenje vi≈°e razliƒçitih programskih modela.
- U ovom sluƒçaju to su OpenMP i OpenMPI kako bi se iskoristila dva razliƒçita nivoa paralelizma.

---

## Ciljna arhitektura

![](img/hibrid.png)

.footer.medium[
  [Detaljnije](http://pages.tacc.utexas.edu/~eijkhout/pcse/html/mpi-functional.html)

] 

---

## Kompajliranje hibridnih OpenMP-OpenMPI programa

- Pozicionirati se u direktorijum u kojem se nalazi izvorni kod hibridnog programa i pokrenuti:

```console
mpicc <izvorna_datoteka> -fopenmp
```

- Pokretanje:

```console
OMP_NUM_THREADS=<Nmp> \ mpiexec [-np <Nmpi>] <izvrsna_datoteka>
```

- `-np <Nmpi>` - opcija za zadavanje broja procesa OpenMPI procesa.
- `OMP_NUM_THREADS = <Nmp>` - maksimalan broj OpenMP niti po MPI procesu

---
layout: false
name: primer
class: center, middle, inverse

# Primer

---
layout: true

.section[[Primer](#sadrzaj)]

---

## Primer 1: <a target="_blank" rel="noopener noreferrer" href="/courses/hpc-z5-openMPI/#table-of-contents"> ‚òõ Primeri/`hello-world.c`</a>

```c
  int main(int argc, char *argv[]) {
    int rank;

    MPI_Init(&argc, &argv);
    MPI_Comm_rank(MPI_COMM_WORLD, &rank);

  #pragma omp parallel
    {
    printf("Hello World iz procesa %d i niti %d.\n", rank, omp_get_thread_num());
    }

    MPI_Finalize();

    return 0;
  }
```

---

## MPI taksonimija interoperabilnosti niti
- Nivoi interoperabilnosti po standardu MPI 3.1:
	- `MPI_THREAD_SINGLE` - Samo jedna nit u MPI procesu.
	- `MPI_THREAD_FUNNELED` - MPI proces mo≈æe imati vi≈°e niti, ali MPI pozive mo≈æe izvr≈°avati samo glavna nit.
	- `MPI_THREAD_SERIALIZED` - MPI proces mo≈æe imati vi≈°e niti i sve niti mogu izvr≈°avati MPI pozive, ali pozivi ne mogu biti izvr≈°avani konkurentno iz dve razliƒçite niti, nego se serijalizuju.
	- `MPI_THREAD_MULTIPLE` - MPI proces mo≈æe imati vi≈°e niti, niti mogu izvr≈°avati MPI pozive bez ograniƒçenja.

- **Direktna razmena poruka podr≈æana samo izmeƒëu procesa - ne mo≈æe se eksplicitno adresirati nit.**

---

## MPI taksonimija interoperabilnosti niti

![](img/hibrid2.png)

---

## MPI taksonimija interoperabilnosti niti

Nemaju sve MPI implementacije isti nivo podr≈°ke za rad sa vi≈°e niti. `MPI_init_thread`.ref[2] umesto `MPI_Init`..ref[1]
```c
int MPI_Init_thread(int *argc, char ***argv, int required, int *provided)
```
- (ulazni parametar)
```c
required := MPI_THREAD_SINGLE | MPI_THREAD_FUNNELED | MPI_THREAD_SERIALIZED | MPI_THREAD_MULTIPLE
```
- (izlazni parametar)
```c
provided := MPI_THREAD_SINGLE | MPI_THREAD_FUNNELED | MPI_THREAD_SERIALIZED | MPI_THREAD_MULTIPLE
```

.footer.medium[
<a target="_blank" rel="noopener noreferrer" href="https://www.open-mpi.org/doc/v3.1/man3/MPI_Init.3.php">1. MPI_Init</a><br>
<a target="_blank" rel="noopener noreferrer" href="https://www.open-mpi.org/doc/v3.1/man3/MPI_Init_thread.3.php">2. MPI_Init_thread</a>
] 

---

## Performanse hibridnog re≈°enja

<br><br><br><br>
> "Consider going hybrid only if pure MPI scalability is not satisfactory." .ref[*]

  
.footer[
\* Preuzeto iz knjige "Introduction to High Performance Computing for Scientists and Engineers" 
]

---

## Performanse hibridnog re≈°enja

<br><br><br>
- ... veoma zavise od broja procesa, broja niti u okviru procesa, MPI i MP implementacije, arhitekture na kojoj se hibridni program pokreƒáe, same implementacije re≈°enja, itd. ...

---

## Prednosti i mane hibridnih re≈°enja

.lcol[

- Bolje iskori≈°ƒáenje ke≈°a.
- Eksploatisanje dodatnih nivoa paralelizma u odnosu na ƒçisto MPI re≈°enje.
- Smanjenje vremena izvr≈°avanja preklapanjem komunikacije i raƒçunanja.
- ...
]

.rcol[

- MNOGO zahtevnije za pisanje vi≈°e posla oko osmi≈°ljavanja re≈°enja, pisanja koda bez ≈°tetnog preplitanja, mnogo vi≈°e potencijalnih mesta za pravljenje neefikasnog re≈°enja usled kori≈°ƒáenja dva razliƒçita programska modela.
- ƒåesto je nemoguƒáe inkrementalno napraviti hibridno re≈°enje od nehibridnog re≈°enja - zahteva pisanje re≈°enja od poƒçetka.
- ...
]

---

## Alternativne tehnologije

- MPI za komunikaciju izmeƒëu ƒçvorova, MPI 3.0 model za deljenu memoriju
- MPI za komunikaciju izmeƒëu ƒçvorova, pthreads model za deljenu memoriju
- ...

---

layout: false
name: zadaci
class: center, middle, inverse

# Zadaci

---
layout: true

.section[[Zadaci](#sadrzaj)]

---

## Zadatak 1: Raƒçunanje broja œÄ

.message.is-info[
.message-header[
Zadatak
]
.message-body[
- Implementirati ƒçisto OpenMPI i hibridno OpenMP-OpenMPI re≈°enje za raƒçunanje broja œÄ raƒçunanjem vrednosti integrala

<p>

$$ \int_{0}^{1} \frac{4}{(1+x^{2})} $$
  
</p>

- Sekvencijalna i OpenMP verzija programa su date u direktorijumu resenja.
	- Porediti vreme izvr≈°avanja hibridnog re≈°enja sa vremenom izvr≈°avanja OpenMP ubrzanog re≈°enja.
	- Meriti vreme izvr≈°avanja hibridnog re≈°enja za razliƒçite kombinacije broja OpenMPI procesa i OpenMP niti.

]
]

--
.message.is-warning[
.message-header[
Info
]
.message-body[
- **Preporuka**: Implementirati OpenMPI verziju programa na osnovu sekvencijalnog re≈°enja, pa je pro≈°iriti OpenMP direktivama.
]
]

---

## Zadatak 2: Pretraga niza brojeva

.message.is-info[
.message-header[
Zadatak
]
.message-body[
- Implementirati sekvencijalno i hibridno OpenMPI-OpenMP re≈°enje za pretragu niza celih brojeva minimalne du≈æine milion elemenata.
- Elemente niza generisati nasumiƒçno iz intervala [-100, 100].
	- Meriti vreme izvr≈°avanja hibridnog re≈°enja za razliƒçite kombinacije broja OpenMPI procesa i OpenMP niti.
	- Opciono implementirati ƒçisto OpenMPI i ƒçisto OpenMP re≈°enje i porediti performanse ovih re≈°enja porediti sa performnsama hibridnog re≈°enja
]
]

--
.message.is-warning[
.message-header[
Info
]
.message-body[
- **Preporuka**: Implementirati OpenMPI verziju programa na osnovu sekvencijalnog re≈°enja, pa je pro≈°iriti OpenMP direktivama.
]
]

---

## Zadatak 3: Mno≈æenje matrica - domaƒái

.message.is-info[
.message-header[
Zadatak
]
.message-body[
- Implementirati hibridno OpenMP-OpenMPI re≈°enje u C programskom jeziku za mno≈æenje dve kvadratne matrice na osnovu OpenMPI i OpenMP re≈°enja zadataka sa prethodnih ve≈æbi.
- Pretpostaviti da jedan MPI proces distribuira delove matrice preostalim procesima. Kostur re≈°enja koji je potrebno popuniti se nalazi <a target="_blank" rel="noopener noreferrer" href="/courses/hpc-z5-openMPI/#table-of-contents"> ‚òõ Zadaci/`MatrixMultiplicationHybrid`</a> .
	- Rezultujuƒáu matricu saƒçuvati u h5 formatu u datoteci pod nazivom result<nxn>.h5, gde se <nxn> menja dimenzijama matrice koja predstavlja re≈°enje.
	- Meriti vreme izvr≈°avanja hibridnog, OpenMP i OpenMPI re≈°enja i zabele≈æiti ih u prilo≈æenu datoteku <a target="_blank" rel="noopener noreferrer" href="/courses/hpc-z5-openMPI/#table-of-contents"> ‚òõ input_data/`statistika.csv`</a>.
- Meriti vreme izvr≈°avanja hibridnog re≈°enja za razliƒçite kombinacije broja MPI procesa i OpenMP niti. U sluƒçaju da se re≈°enje isprobava na raƒçunaru sa soketom i vi≈°e jezgara, probati sledeƒáe kombinacije:
	- Po jedan MPI proces za svako logiƒçko jezgro
	- Po jedan MPI proces za svako fiziƒçko jezgro i po jedna nit za svako logiƒçko jezgro.
	- Jedan MPI proces i po jedna nit za svako logiƒçko jezgro.

- Po ≈æelji dodati jo≈° razliƒçitih konfiguracija i rezultate upisati u statistika.csv. Analizirati dobijene rezultate.
- Pri analizi performansi re≈°enja mo≈æe pomoƒái poglavlje 11 knjige "Introduction to high performance computing for Scientists and Engineers."

]
]

---

layout: false

## Materijali

- Georg Hager, Gerhard Wellein, "Introduction to High Performance Computing for Scientists and Engineers"
- [MPI 3.1 standard, poglavlje 12.4](https://www.mpi-forum.org/docs/mpi-3.1/mpi31-report.pdf)
- [OpenMP dokumentacija](https://www.open-mpi.org/doc/)
- [OpenMP SC13 Tutorial: Hybrid MPI and OpenMP Parallel Programming](https://www.openmp.org/press-release/sc13-tutorial-hybrid-mpi-openmp-parallel-programming/)

--

class: center, middle, theend, hide-text
layout: false
background-image: url(../theend.gif)

</textarea>
	<script src="../remark-latest.min.js"></script>
	<script>
		// https://github.com/gnab/remark/issues/72
		        remark.macros.scale = function (percentage) {
		            var url = this;
		            return '<div class="center"><img src="'
		                 + url + '" style="width: ' + percentage + '" /></div>';
		        };
		        var slideshow = remark.create({
		                    highlightLanguage: 'python',
		                    // highlightStyle: 'obsidian',
		                    highlightStyle: 'github',
		                    highlightLines: true,
		                    countIncrementalSlides: false,
		                    navigation: {
		                      // Enable or disable navigating using scroll
		                      // Default: true
		                      // Alternatives: false
		                      scroll: false,
		
		                      //click: true,
		                    }
		                });
	</script>
	<script src="../mermaid.min.js"></script>
	<script>
		mermaid.initialize({startOnLoad:true});
	</script></body>

</html>